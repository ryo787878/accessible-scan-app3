# Accessible Scan 設計書（ページ機能一覧）

## 1. 目的
本ドキュメントは、`/Users/ryo99/accessible-scan-app3` の現行実装を対象に、各ページで利用者が何をできるかを整理したものです。

## 2. 画面一覧（ルーティング）
- `/` : トップページ（診断開始）
- `/scan/[publicId]` : 診断進捗ページ
- `/report/[publicId]` : 診断レポートページ

## 3. ページ別仕様

### 3.1 `/` トップページ（診断開始）
**目的**
- アクセシビリティ診断の開始地点。

**できること**
- ツール概要（WCAG 2.1準拠チェック、可視化、改善優先度）を確認できる。
- 診断対象URLを入力できる。
- 診断ページ数（1〜20ページ）をスライダーで指定できる。
- 入力URLのバリデーションを受けられる。
  - 未入力エラー
  - `http://` / `https://` 形式チェック
  - URL構文チェック
- 「無料診断を開始」で診断ジョブを作成できる。
- APIエラー時にトースト通知を受けられる（レート制限含む）。
- 診断開始成功時に `/scan/[publicId]` へ遷移できる。

**主な利用API**
- `POST /api/scans`

---

### 3.2 `/scan/[publicId]` 診断進捗ページ
**目的**
- 診断実行中の状態監視と完了後のレポート遷移。

**できること**
- 対象URLを確認できる。
- 進捗率（%）をプログレスバーで確認できる。
- 成功件数・失敗件数・残件数を確認できる。
- ページごとの状態（待機中/診断中/完了/失敗）を一覧で確認できる。
- 約2秒間隔のポーリングで最新状態を自動更新できる。
- 診断完了時に「レポートを見る」から `/report/[publicId]` へ遷移できる。
- 一部失敗時でも、完了済み結果のレポートへ遷移できる。
- `publicId` 不正や通信失敗時はエラー表示とトップ復帰ができる。

**主な利用API**
- `GET /api/scans/[publicId]`

---

### 3.3 `/report/[publicId]` 診断レポートページ
**目的**
- 診断結果の可視化、課題優先度の把握、ページ単位での具体的修正確認。

**できること**
- レポート準備中はローディング表示のまま完了まで待機できる（ポーリング）。
- 診断対象URL、診断日時、診断完了ページ数を確認できる。
- アクセシビリティスコアを確認できる。
  - ゲージ表示（アニメーション）
  - 重大度別件数（critical/serious/moderate/minor）
  - 違反ルール数、診断ページ数、合格ルール数
- サマリー指標を確認できる。
  - 検出違反数（要素ベース）
  - 緊急+重大件数
  - 診断ページ数
  - 合格ルール数
- 上位課題TOP5を確認できる。
  - 日本語ルール名
  - 重大度
  - 説明
  - 修正方法
  - 該当ページ数/要素数
  - 外部詳細リンク（Deque University）
- ルール別集計をタブで絞り込める（すべて/重大/高/中/低）。
- 各ルールの「詳細」ボタンから、ページ別詳細の該当箇所へスクロール遷移できる。
- ページ別詳細をアコーディオンで展開し、以下を確認できる。
  - ページごとの違反ルール数/要素数
  - 対象HTML
  - CSSセレクタ
  - failure summary（修正ヒント）
- 取得失敗ページがある場合、エラーコード・メッセージを確認できる。
- 「ルール別集計へ戻る」ボタン（固定表示含む）で上部へ戻れる。
- 「新しい診断を開始」でトップページへ戻れる。
- エラー時はトップページまたは進捗ページへ遷移できる。

**主な利用API**
- `GET /api/scans/[publicId]/report`

## 4. 共通UI仕様（全ページ）
- ヘッダー
  - ロゴからトップへ戻れる。
  - トップ以外では「新しい診断を開始」リンクを表示。
- フッター
  - トップリンクを表示。
  - 「自動診断のみ」の注記を表示。
- 通知
  - トースト通知（sonner）を利用。

## 5. APIルート一覧（補足）
- `POST /api/scans` : 診断ジョブ作成
- `GET /api/scans/[publicId]` : 診断進捗取得
- `GET /api/scans/[publicId]/report` : レポート取得

## 6. 想定ユーザーフロー
1. `/` で URL と診断ページ数を設定して診断開始。
2. `/scan/[publicId]` で進捗を監視。
3. 完了後 `/report/[publicId]` で結果分析と修正優先度を確認。
4. トップへ戻って再診断。
